<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>4択クイズゲーム</title>
<style>
body { font-family:sans-serif; padding:20px; background:#f8fafc; }
.hidden { display:none; }
button { margin:4px; padding:6px 12px; border-radius:6px; border:1px solid #aaa; cursor:pointer; }
.genreBtn { display:inline-block; background:#e2e8f0; }
.genreBtn:hover { background:#cbd5e1; }
h2 { margin-top:1em; }
.tab { padding:5px 10px; cursor:pointer; border:1px solid #aaa; margin-right:5px; display:inline-block; }
.active-tab { background:#0f172a; color:#fff; }
#adminPass,#adminLoginBtn { display:none; margin-top:4px; }
</style>
</head>
<body>

<h1>4択クイズゲーム</h1>

<div id="home">
  <div id="nameSection">
    名前: <input type="text" id="playerNameInput" placeholder="名前を入力">
    <button id="saveNameBtn">登録</button>
  </div>
  <div id="welcome" class="hidden">
    <p>ようこそ、<span id="playerNameDisplay"></span> さん！ 
      <button id="showRankingBtn">ランキング</button>
    </p>
  </div>
  <hr>
  <h2>ジャンルを選択</h2>
  <div id="genreButtons"></div>
</div>

<div id="quiz" class="hidden"></div>
<div id="result" class="hidden"></div>

<div id="ranking" class="hidden">
  <div id="rankingTabs">
    <span class="tab active-tab" data-tab="ジャンル">ジャンル別</span>
    <span class="tab" data-tab="合計">全ジャンル合計</span>
  </div>
  <div id="rankingContent"></div>
  <button onclick="location.reload()">ホームへ</button>
</div>

<div id="adminPanel" class="hidden">
  <h2>ユーザー管理</h2>
  <div id="adminControls" style="display:flex; align-items:center; gap:6px; margin-bottom:8px;">
    <input type="password" id="adminPass" placeholder="パスキー" style="flex:1;">
    <button id="adminLoginBtn">ログイン</button>
    <button id="logoutAdminBtn">ログアウト</button>
  </div>
  <div id="adminUserList"></div>
</div>

<script>
// ---- 設定 ----
const BASE_POINTS = 100;
const STREAK_BONUS_STEP = 20;
const QUESTIONS_PER_GENRE = 10;
const ADMIN_PASSKEY = "4F7K2D9J8L6M3Q1T0B5N7R2W8X1Y6Z3A9C0E4G7H2J5L8M1P3Q6R9S0T4U7V2W5X8Y1Z3A6B9C0D4E7F2G5H8";


// ---- animeQuestions ----
const animeQuestions = [
    { q: "うずまきナルトの担当上忍は誰？", options: ["カカシ", "ジライヤ", "イルカ", "ヒルゼン"], answer: 0 },
    { q: "キラの本名は？", options: ["夜神 月", "夜神 総一郎", "シドウ", "魅上 照"], answer: 0 },
    { q: "黒トリガーである「卵の冠」の能力は？", options: ["トリオンのキューブ化", "強制ベイルアウト", "攻撃の無効化", "分身体の生成"], answer: 0 },
    { q: "二刀流最上位ソードスキル「ジ・イクリプス」の連撃数は？", options: ["26", "27", "28", "29"], answer: 1 },
    { q: "魔女教大罪司教の空席はどこ？", options: ["憤怒", "傲慢", "虚飾", "憂鬱"], answer: 1 },   
    { q: "ワンパンマンに出てくるS級ヒーローのうち12位は誰？", options: ["ぷりぷりプリズナー", "閃光のフラッシュ", "番犬マン", "超合金クロビカリ"], answer: 2 },
    { q: "Mr.3の悪魔の実は？", options: ["スパスパの実", "ドルドルの実", "マネマネの実", "ボムボムの実"], answer: 1 },
    { q: "ドラえもんのネズミ恐怖症の理由は？", options: ["過去にかじられた", "未来の猫型ロボットだから", "小動物だから", "アニメだから"], answer: 0 },
    { q: "デスノートでリュークの好物は？", options: ["リンゴ", "バナナ", "チョコ", "ケーキ"], answer: 0 },
    { q: "鋼の錬金術師で兄エドワードの弟の名前は？", options: ["アルフォンス", "ロイ", "ウィンリィ", "マーリン"], answer: 0 },

    { q: "悟空の最終形態は？", options: ["スーパーサイヤ人", "スーパーサイヤ人4", "スーパーサイヤ人ブルー", "身勝手の極意"], answer: 3 },
    { q: "鬼滅の刃でカナヲの呼吸は？", options: ["花", "水", "風", "雷"], answer: 0 },
    { q: "リムルが魔王になるために集めた魂の数は？", options: ["1000", "5000", "10000", "20000"], answer: 2 },
    { q: "剣の勇者である天木 錬のもつカースは何か？", options: ["色欲", "憤怒", "傲慢", "暴食"], answer: 3 },
    { q: "ドラえもんの秘密道具スモールライトの効果は？", options: ["物を小さくする", "物を大きくする", "透明にする", "飛ばす"], answer: 0 },
    { q: "個性「オール・フォー・ワン」の所有者は？", options: ["死柄木 全", "志村 菜奈", "志村 弧太郎", "キャスリーン・ベイト"], answer: 0 },
    { q: "井ノ上たきなの使用しているメインウェポンは？", options: ["P90", "Grok21", "PKM", "S&W M&P99L"], answer: 3 },
    { q: "魔女教大罪司教「強欲」担当レグルス・コルニアスの持つ権能、「獅子の心臓」はどんな効果か？", options: ["自身や触れたものの時間を止める", "他者に心臓を埋め込む", "触れた相手の加護や権能を無力化する", "不老不死"], answer: 0 },
    { q: "銃の悪魔が中国に上陸した時に何人が死亡したか？", options: ["31万6932人", "54万8012人", "15万5302人", "5万7912人"], answer: 0 },
    { q: "上弦の壱である黒死牟の使う呼吸は？", options: ["月", "血", "夜", "鬼"], answer: 0 },

    { q: "エギルが現実世界で営んでいるカフェ兼バーの店名は？", options: ["ダイナソー・カフェ", "ダインズ・カフェ", "アンドリュー・カフェ", "ダイシー・カフェ"], answer: 3 },
    { q: "最終形態時のフリーザの戦闘力は？", options: ["53万", "100万", "6000万", "1億2000万"], answer: 3 },
    { q: "勇気百倍アンパンマンはどんな時になるか？", options: ["アンパンを限界まで焼いた時", "アンパンの中身をこしあんにした時", "勇気の花が開花した時", "アンパンマンがみんなから力を集めた時"], answer: 2 },
    { q: "ドラゴンボールでトランクスの父は？", options: ["ベジータ", "悟空", "ピッコロ", "クリリン"], answer: 0 },
    { q: "うちは一族の使う眼の能力は？", options: ["写輪眼", "白眼", "輪廻眼", "封印術"], answer: 0 },
    { q: "この中でホムンクルスではない者は？", options: ["スロウス", "ラース", "ホーエンハイム", "エンヴィー"], answer: 2 },
    { q: "セーラームーンの変身アイテムは？", options: ["月のステッキ", "ブローチ", "ティアラ", "ルナペンダント"], answer: 1 },
    { q: "青い正八面体の形推した第5使徒の名前は？", options: ["ラミエル", "シャムシエル", "ガギエル", "マトリエル"], answer: 0 },
    { q: "進撃の巨人に出てくる壁の高さは？", options: ["40m", "45m", "50m", "60m"], answer: 2 },
    { q: "「エロマンガ」をペンネームにしているイラストレーターの名前は？", options: ["和泉 紗霧", "エミリー・グレンジャー", "梅園 花", "アメリア・アルメリア"], answer: 0 },

    { q: "名探偵コナンで唯一犯人が自殺してしまった話は？", options: ["ピアノソナタ月光殺人事件", "赤鬼村火祭殺人事件", "魔女の棲むお菓子の家", "二度死んだ男"], answer: 0 },
    { q: "デンジの持つ悪魔の力は？", options: ["天使の悪魔", "刀の悪魔", "チェーンソーの悪魔", "狐の悪魔"], answer: 2 },
    { q: "竈門炭治郎の使う呼吸は？", options: ["水", "岩", "風", "雷"], answer: 0 },
    { q: "ドレスローザで景品にされていた悪魔の実は？", options: ["グラグラの実", "ヒエヒエの実", "ピカピカの実", "メラメラの実"], answer: 3 },
    { q: "ドラえもんの好きな食べ物は？", options: ["どら焼き", "ケーキ", "チョコ", "たい焼き"], answer: 0 },
    { q: "セーラームーンの決め台詞は？", options: ["月に代わっておしおきよ！", "愛と正義の戦士！", "必殺！ムーンパワー！", "世界を救うわ！"], answer: 0 },
    { q: "浦飯幽助の死因は？", options: ["病気による衰弱死", "通り魔に刺された", "車に轢かれた", "自殺"], answer: 2 },
    { q: "ジョジョの奇妙な冒険2部の主人公は？", options: ["ジョナサン", "ジョセフ", "承太郎", "仗助"], answer: 1 },
    { q: "るろうに剣心の主人公の異名は？", options: ["人斬り抜刀斎", "飛天御剣流", "剣心様", "流浪人"], answer: 0 },
    { q: "銀魂の主人公は？", options: ["坂田銀時", "志村新八", "桂小太郎", "高杉晋助"], answer: 0 },

    { q: "ブラックジャックの職業は？", options: ["医者", "探偵", "剣士", "科学者"], answer: 0 },
    { q: "コードギアスの主人公の名前は？", options: ["ルルーシュ", "スザク", "C.C.", "カレン"], answer: 0 },
    { q: "エヴァンゲリオンの17使徒は？", options: ["碇シンジ", "渚カヲル", "葛城ミサト", "綾波レイ"], answer: 1 },
    { q: "BLEACHの主人公は？", options: ["黒崎一護", "石田雨竜", "井上織姫", "阿散井恋次"], answer: 0 },
    { q: "Re:ゼロから始める異世界生活の主人公は？", options: ["ナツキ・スバル", "ラインハルト", "ベアトリス", "エミリア"], answer: 0 },
    { q: "Re:ゼロで三大魔獣ではないものは？", options: ["多兎", "黒蛇", "ウルガルム", "白鯨"], answer: 2 },
    { q: "この素晴らしい世界に祝福を！のアクシズ教団の崇める女神の名前は？", options: ["アクア", "エリス", "ダクネス", "ウィズ"], answer: 0 },
    { q: "オーバーロードの世界のゲーム名は？", options: ["アビス", "ユグドラシル", "フロンティア", "ブラッククローン"], answer: 1 },
    { q: "ノーゲーム・ノーライフの主人公コンビは？", options: ["空と白", "キリトとアスナ", "レムとラム", "カズマとアクア"], answer: 0 },
    { q: "小林さんちのメイドラゴンのドラゴン娘は？", options: ["トール", "カンナ", "ルコア", "イルル"], answer: 0 },

    { q: "五等分の花嫁で主人公の家庭教師は？", options: ["上杉風太郎", "中野一花", "中野二乃", "中野三玖"], answer: 0 },
    { q: "五等分の花嫁の五つ子の苗字は？", options: ["中野", "上杉", "高木", "木下"], answer: 0 },
    { q: "かぐや様は告らせたいの主人公の生徒会長は？", options: ["石上優", "白銀御行", "藤原千花", "四宮かぐや"], answer: 1 },
    { q: "七つの魔剣が支配するの主人公が使用する魔剣の名前は？", options: ["己へと奔る影（クーレウンブラ）", "奈落を渡る糸（アングスタヴィア）", "死せる胡蝶の夢（パピリオソムニア）", "感情的な魔法則（ヒステリックセオリー）"], answer: 1 },    { q: "キラの本名は？", options: ["夜神 月", "夜神 総一郎", "シドウ", "魅上 照"], answer: 0 },
    { q: "金木研の好きな食べ物は？", options: ["コーヒー", "ラーメン", "ハンバーグ", "寿司"], answer: 2 },
    { q: "五条悟の術式は？", options: ["無下限呪術", "十種影法術", "黒閃", "領域展開：伏魔御廚子"], answer: 0 },
    { q: "乙骨憂太の特級怨霊は？", options: ["祈本里香", "宿儺", "真人", "夏油傑"], answer: 0 },
    { q: "サマーウォーズの主人公が解いた暗号の名前は？", options: ["RSA暗号", "AES暗号", "CBC暗号", "SIDH暗号"], answer: 0 },
    { q: "岡部倫太郎の自称は？", options: ["狂気のマッドサイエンティスト", "未来の救世主", "紅い錬金術師", "絶対的探偵"], answer: 0 },

    { q: "ルルーシュが持つ力は？", options: ["ギアス", "写輪眼", "直死の魔眼", "死神の眼"], answer: 0 },
    { q: "涼宮ハルヒの憂鬱の主人公は？", options: ["キョン", "古泉一樹", "長門有希", "朝比奈みくる"], answer: 0 },
    { q: "長門有希の正体は？", options: ["宇宙人", "未来人", "超能力者", "普通の人間"], answer: 0 },
    { q: "とある魔術の禁書目録の主人公は？", options: ["上条当麻", "御坂美琴", "一方通行", "神裂火織"], answer: 0 },
    { q: "御坂美琴の異名は？", options: ["超電磁砲", "火炎姫", "氷の女王", "雷帝"], answer: 0 },
    { q: "心意システムのうち、できないものは？", options: ["所有する武器を手元に引き戻すことができる", "指の本数以上の素因（エレメント）の生成", "自分の記憶に根強く残っている姿への変身", "カーディナルコードの使用"], answer: 3 },
    { q: "アスナの二つ名は？", options: ["閃光", "剣姫", "雷光", "白百合"], answer: 0 },
    { q: "暴食の大罪司教のうち、飽食をつかさどるのは誰？", options: ["ライ・バテンカイトス", "ロイ・アルファルド", "ルイ・アルネブ", "テュフォン"], answer: 2 },
    { q: "エキドナが眠っている場所は？", options: ["ヴォラキア帝国", "聖域", "アーラム村", "エリオール大森林"], answer: 1 },
    { q: "起動要塞デストロイヤーの動力は？", options: ["アダマンタイト", "コロナタイト", "スターダスト", "ダイヤモンド"], answer: 1 },

    { q: "魔女の宅急便の主人公は？", options: ["キキ", "ナウシカ", "シータ", "サン"], answer: 0 },
    { q: "天空の城ラピュタのヒロインは？", options: ["シータ", "キキ", "ナウシカ", "クラリス"], answer: 0 },
    { q: "風の谷のナウシカの主人公は？", options: ["ナウシカ", "サン", "シータ", "キキ"], answer: 0 },
    { q: "もののけ姫の主人公は？", options: ["アシタカ", "サン", "ナウシカ", "モロ"], answer: 0 },
    { q: "千と千尋の神隠しの主人公は？", options: ["千尋", "ハク", "湯婆婆", "リン"], answer: 0 },
    { q: "ジョジョ3部のスタンドの名前は？", options: ["スタープラチナ", "ザ・ワールド", "ハーミットパープル", "クレイジーダイヤモンド"], answer: 0 },
    { q: "ジョジョ5部の主人公は？", options: ["ジョルノ", "ブチャラティ", "ミスタ", "ディアボロ"], answer: 0 },
    { q: "ジョジョ6部の主人公は？", options: ["徐倫", "承太郎", "エンポリオ", "プッチ"], answer: 0 },
    { q: "キルアの家族の職業は？", options: ["暗殺者", "医者", "盗賊", "念能力師"], answer: 0 },
    { q: "クラピカの一族の特徴は？", options: ["緋の眼", "獣耳", "白髪", "氷の力"], answer: 0 },

    { q: "ゾロの得意な剣術スタイルは？", options: ["三刀流", "二刀流", "一刀流", "四刀流"], answer: 0 },
    { q: "サンジの夢は？", options: ["オールブルーを見つける", "世界最強の剣士", "海賊王になる", "世界政府を倒す"], answer: 0 },
    { q: "フリーザの戦闘力53万はどの形態？", options: ["第一形態", "最終形態", "ゴールデン", "メカフリーザ"], answer: 0 },
    { q: "高坂京介が玄関で拾ったDVDの中に入っていたアダルトゲームのタイトルは？", options: ["星くず☆うぃっちメルル", "妹と恋しよっ♪", "妹空", "妹×妹〜しすこんラブすとーりぃ〜"], answer: 1 },
    { q: "インデックスの記憶している魔道書の冊数は？", options: ["13,000冊", "103,000冊", "130,000冊", "310,000冊"], answer: 1 },
    { q: "平子信二の斬魄刀の卍解は？", options: ["千本桜景厳", "大紅蓮氷輪丸", "金色疋殺地蔵", "逆様邪八宝塞"], answer: 3 },
    { q: "魔法少女にさせる契約を持ちかける生物は？", options: ["キュゥべえ", "モモ", "ルビー", "クロ"], answer: 0 },
    { q: "キノの相棒であるモトラドの名前は？", options: ["ヘルメス", "パースエイダー", "スパイダー", "エルメス"], answer: 3 },
    { q: "ケロロの趣味は？", options: ["ガンプラ作り", "釣り", "料理", "ゲーム"], answer: 0 },
    { q: "東雲なのの正体は？", options: ["ロボット", "宇宙人", "未来人", "幽霊"], answer: 0 },

    { q: "セイバーの真名は？", options: ["アルトリア・ペンドラゴン", "ギルガメッシュ", "ジャンヌ・ダルク", "スカサハ"], answer: 0 },
    { q: "岡部倫太郎の自称は？", options: ["狂気のマッドサイエンティスト", "未来の救世主", "紅い錬金術師", "絶対的探偵"], answer: 0 },
    { q: "天野雪輝のもつ未来日記は？", options: ["殺人日記", "無差別日記", "雪輝日記", "常勝無敗ケンカ日記"], answer: 1 },
    { q: "みおに頼まれてゆっこが買ってきた昼飯は？", options: ["揚げパン", "焼きそば", "ラーメン", "焼き鯖"], answer: 3 },
    { q: "マーレの手から逃れた九つの巨人は？", options: ["戦鎚の巨人", "女型の巨人", "進撃の巨人", "車力の巨人"], answer: 2 },
    { q: "金木研はどうやって喰種になった？", options: ["喰種の内蔵を移植された", "他の喰種と契約した", "興味本位で人間の肉を食べた", "喰種と性行為をした"], answer: 0 },
    { q: "異世界かるてっと！での2組の学級委員長は？", options: ["デミウルゴス", "エミリア", "クリス", "ルーデルドルフ"], answer: 1 },
    { q: "紺野木綿季の死因は？", options: ["AIDS", "HIV", "白血病", "心臓麻痺"], answer: 1 },
    { q: "伊藤誠の最期は？", options: ["世界に刺された", "言葉に刺された", "乙女に刺された", "刹那に刺された"], answer: 0 },
    { q: "ハッピーカメラの本来の使い方は？", options: ["鈍器として殴る", "撮った写真を読み込むことでそのタイミングにタイムスリップする", "誰かと撮ることでその人と仲良くなれる", "撮影した人の時を止める"], answer: 1 },
]

// ---- KanjiQuestions ----
const KanjiQuestions = [
    { q: "「海」の部首は？", options: ["さんずい", "みずへん", "うかんむり", "したごころ"], answer: 0 },
    { q: "「鶴」の読みとして正しいのは？", options: ["つばめ", "つる", "かもめ", "とり"], answer: 1 },
    { q: "「森」の画数は？", options: ["10画", "12画", "14画", "16画"], answer: 1 },
    { q: "「桜」の旧字体は？", options: ["櫻", "櫞", "楢", "槇"], answer: 0 },
    { q: "「戦」の部首は？", options: ["いくさ", "たたかう", "ひとやね", "ほこづくり"], answer: 3 },
    { q: "「麗しい」の読みは？", options: ["きよらかしい", "うるわしい", "はなやかしい", "あざやかしい"], answer: 1 },
    { q: "「雲」の画数は？", options: ["8画", "9画", "12画", "16画"], answer: 2 },
    { q: "「匠」の意味として正しいものは？", options: ["医者", "職人", "商人", "学者"], answer: 1 },
    { q: "「瞬間」の「瞬」の読みは？", options: ["またたき", "しゅん", "とき", "せん"], answer: 1 },
    { q: "「炎」の部首は？", options: ["火", "山", "人", "日"], answer: 0 },

    { q: "「影響」の「影」の読みは？", options: ["かげ", "ひかり", "えい", "よう"], answer: 2 },
    { q: "「驚く」の部首は？", options: ["うまへん", "けものへん", "とりへん", "あめかんむり"], answer: 0 },
    { q: "「緑」の旧字体は？", options: ["録", "綠", "縁", "緖"], answer: 1 },
    { q: "「哲学」の「哲」の意味は？", options: ["さとい", "おろか", "つよい", "ただしい"], answer: 0 },
    { q: "「翼」の画数は？", options: ["15画", "17画", "19画", "20画"], answer: 1 },
    { q: "「謎」の訓読みは？", options: ["なぞ", "めい", "かい", "しん"], answer: 0 },
    { q: "「鏡」の部首は？", options: ["かねへん", "たまへん", "めへん", "ころもへん"], answer: 0 },
    { q: "「舞う」の旧字体は？()内は下部", options: ["舞", "舞(弋)", "舞(夂)", "舞(舛)"], answer: 3 },
    { q: "「鋭い」の読みは？", options: ["きつい", "するどい", "ほそい", "はやい"], answer: 1 },
    { q: "「漢」の部首は？", options: ["さんずい", "くさかんむり", "あめかんむり", "くにがまえ"], answer: 0 },
    
    { q: "「慧」の音読みは？", options: ["さとい", "すぐれる", "え", "すい"], answer: 2 },
    { q: "「熟」の訓読みは？", options: ["にる", "うれる", "やく", "おちる"], answer: 1 },
    { q: "「闇」の部首は？", options: ["もんがまえ", "ひ", "おとへん", "こざとへん"], answer: 0 },
    { q: "「誓う」の部首は？", options: ["ごんべん", "てへん", "こころ", "おおざと"], answer: 0 },
    { q: "「響」の画数は？", options: ["20画", "21画", "22画", "23画"], answer: 0 },
    { q: "「穏やか」の「穏」の音読みは？", options: ["おん", "そん", "あん", "えん"], answer: 0 },
    { q: "「憂う」の部首は？", options: ["こころへん", "うかんむり", "りっしんべん", "あめかんむり"], answer: 2 },
    { q: "「曙」の訓読みは？", options: ["しょ", "あけぼの", "ひがし", "ほのか"], answer: 1 },
    { q: "「厳しい」の旧字体は？", options: ["嚴", "儼", "巖", "嚴厳"], answer: 0 },
    { q: "「繊維」の「繊」の読みは？", options: ["せん", "さい", "ぜん", "しん"], answer: 0 },

    { q: "「翼」の部首は？", options: ["つばさ", "よく", "ならかんむり", "はね"], answer: 3 },
    { q: "「曖昧」の「曖」の音読みは？", options: ["あい", "まい", "えん", "えい"], answer: 0 },
    { q: "「匠」の意味は？", options: ["武士", "技術に優れた人", "農民", "王族"], answer: 1 },
    { q: "「鬱」の画数は？", options: ["28画", "29画", "30画", "32画"], answer: 1 },
    { q: "「斬る」の部首は？", options: ["かたな", "おの", "りっとう", "とり"], answer: 1 },
    { q: "「赦す」の音読みは？", options: ["しゃ", "さ", "や", "じょ"], answer: 0 },
    { q: "「勲章」の「勲」の意味は？", options: ["功績", "勇気", "学問", "忠義"], answer: 0 },
    { q: "「寛ぐ」の読みは？", options: ["かんぐ", "くつろぐ", "ひろぐ", "ゆるぐ"], answer: 1 },
    { q: "「峠」の部首は？", options: ["やま", "さんづくり", "こざと", "だい"], answer: 0 },
    { q: "「曽」の音読みは？", options: ["そ", "しょう", "そう", "せい"], answer: 2 },

    { q: "「漆」の訓読みは？", options: ["うるし", "つや", "にかわ", "みず"], answer: 0 },
    { q: "「禅」の部首は？", options: ["しめすへん", "こころ", "てへん", "おおざと"], answer: 0 },
    { q: "「頑固」の「頑」の音読みは？", options: ["がん", "こん", "けん", "かん"], answer: 0 },
    { q: "「藍」の部首は？", options: ["くさかんむり", "あお", "みず", "しろ"], answer: 0 },
    { q: "「懐かしい」の「懐」の音読みは？", options: ["かい", "えん", "けい", "さい"], answer: 0 },
    { q: "「畏敬」の「畏」の意味は？", options: ["うやまう", "おそれる", "かしこい", "あやしい"], answer: 1 },
    { q: "「朽ちる」の反対語は？", options: ["栄える", "新しい", "燃える", "育つ"], answer: 0 },
    { q: "「穫る」の読みは？", options: ["かる", "とる", "ぬる", "える"], answer: 1 },
    { q: "「緻密」の「緻」の音読みは？", options: ["ち", "し", "じ", "てい"], answer: 0 },
    { q: "「曳く」の読みは？", options: ["ひく", "おく", "あまねく", "とく"], answer: 0 },

    { q: "「醸す」の意味は？", options: ["酒をつくる", "雰囲気をつくる", "交わす", "混ぜる"], answer: 1 },
    { q: "「窯」の部首は？", options: ["あなかんむり", "ひ", "かま", "ほのお"], answer: 0 },
    { q: "「曖昧」の「昧」の意味は？", options: ["くらい", "あかるい", "みじかい", "ひかる"], answer: 0 },
    { q: "「繭」の訓読みは？", options: ["まゆ", "いと", "はた", "ぬの"], answer: 0 },
    { q: "「錬金術」の「錬」の音読みは？", options: ["れん", "けん", "せん", "りん"], answer: 0 },
    { q: "「曽祖父」の「曽」の訓読みは？", options: ["かつて", "ひととき", "むかし", "しばし"], answer: 0 },
    { q: "「顧みる」の意味は？", options: ["振り返る", "考える", "見下ろす", "かんがみる"], answer: 0 },
    { q: "「粛清」の「粛」の音読みは？", options: ["しゅく", "そく", "ちょく", "しゅん"], answer: 0 },
    { q: "「遷都」の「遷」の意味は？", options: ["移す", "建てる", "守る", "造る"], answer: 0 },
    { q: "「瞳」の訓読みは？", options: ["ひとみ", "め", "あかり", "まなこ"], answer: 0 },

    { q: "「雌雄」の「雌」の音読みは？", options: ["し", "す", "せい", "しゅう"], answer: 0 },
    { q: "「毅然」の「毅」の意味は？", options: ["つよい", "やさしい", "まじめ", "おおきい"], answer: 0 },
    { q: "「繕う」の訓読みは？", options: ["なおす", "つくろう", "つなぐ", "つめる"], answer: 1 },
    { q: "「曽」の部首は？", options: ["にち", "いわく", "くち", "の"], answer: 1 },
    { q: "「穀物」の「穀」の音読みは？", options: ["こく", "こう", "ごく", "かく"], answer: 0 },
    { q: "「肇」の読みは？", options: ["はじめ", "ひらく", "うごく", "つよい"], answer: 0 },
    { q: "「斎藤」の「斎」の意味は？", options: ["つつしむ", "おおい", "ただしい", "かがやく"], answer: 0 },
    { q: "「瞭然」の「瞭」の音読みは？", options: ["りょう", "じょう", "りん", "せん"], answer: 0 },
    { q: "「藻」の部首は？", options: ["くさかんむり", "さんずい", "あめ", "き"], answer: 0 },
    { q: "「曖昧模糊」の「糊」の意味は？", options: ["のり", "あいまい", "ひかる", "しろい"], answer: 1 },

    { q: "「匿う」の意味は？", options: ["かくまう", "あずける", "まもる", "おさめる"], answer: 0 },
    { q: "「憧れる」の「憧」の音読みは？", options: ["しょう", "とう", "どう", "じょう"], answer: 0 },
    { q: "「瞳孔」の「孔」の意味は？", options: ["あな", "ひかり", "まなこ", "とおる"], answer: 0 },
    { q: "「渇望」の「渇」の訓読みは？", options: ["かわく", "うるおう", "あせる", "かがやく"], answer: 0 },
    { q: "「藩主」の「藩」の意味は？", options: ["はん", "むら", "さかい", "くに"], answer: 2 },
    { q: "「憂鬱」の「鬱」の音読みは？", options: ["うつ", "ゆう", "じゅつ", "いち"], answer: 0 },
    { q: "「曽遊」の「曽」の意味は？", options: ["かつて", "むかし", "しばし", "いま"], answer: 0 },
    { q: "「織る」の音読みは？", options: ["しょく", "しき", "おり", "せん"], answer: 0 },
    { q: "「饗宴」の「饗」の意味は？", options: ["もてなす", "うたげ", "あつまる", "あたえる"], answer: 0 },
    { q: "「顕著」の「顕」の訓読みは？", options: ["あきらか", "ひかる", "みえる", "ととのう"], answer: 0 },

    { q: "「璧」の意味は？", options: ["たま", "かべ", "つるぎ", "かがみ"], answer: 0 },
    { q: "「繋ぐ」の音読みは？", options: ["けい", "け", "さい", "き"], answer: 0 },
    { q: "「顎」の訓読みは？", options: ["あご", "くち", "はな", "ほほ"], answer: 0 },
    { q: "「艶やか」の「艶」の音読みは？", options: ["えん", "てん", "けん", "せん"], answer: 0 },
    { q: "「不撓」の「撓」の音読みは？", options: ["そう", "とう", "そ", "せい"], answer: 1 },
    { q: "「穂」の訓読みは？", options: ["ほ", "たね", "み", "はな"], answer: 0 },
    { q: "「藻類」の「藻」の訓読みは？", options: ["も", "のり", "あお", "わかめ"], answer: 0 },
    { q: "「纏う」の意味は？", options: ["まとう", "かざる", "かける", "かぶせる"], answer: 0 },
    { q: "「顕微鏡」の「顕」の音読みは？", options: ["げん", "きん", "しん", "げん"], answer: 3 },
    { q: "「驚く」の部首は？", options: ["うま", "くさかんむり", "こころ", "けものへん"], answer: 0 },

    { q: "「馨」の意味は？", options: ["よい香り", "かすかな音", "明るい光", "やさしい声"], answer: 0 },
    { q: "「纂」の音読みは？", options: ["ぜん", "さん", "ざん", "しん"], answer: 1 },
    { q: "「鬱陶しい」の「陶」の意味は？", options: ["うつわ", "かみ", "こころをふさぐ", "みず"], answer: 2 },
    { q: "「驕る」の読みは？", options: ["おごる", "あなどる", "さわぐ", "たかぶる"], answer: 0 },
    { q: "「顎鬚」の「鬚」の意味は？", options: ["ひげ", "かみ", "くち", "ほほ"], answer: 0 },
    { q: "「贅沢」の「贅」の意味は？", options: ["むだ", "ゆたか", "おおきい", "あつい"], answer: 0 },
    { q: "「鬣」の訓読みは？", options: ["ひげ", "あし", "たてがみ", "つめ"], answer: 2 },
    { q: "「馨る」の訓読みは？", options: ["かおる", "ひかる", "みちる", "なる"], answer: 0 },
    { q: "「鬱病」の「鬱」の画数は？", options: ["29画", "30画", "32画", "33画"], answer: 0 },
    { q: "「顛末」の「顛」の意味は？", options: ["いただき", "おちる", "つよい", "やま"], answer: 0 },
]

// ---- proverbQuestions ----
const proverbQuestions = [
    { q: "後は野となれ【】となれ", options: ["海", "山", "川", "坂"], answer: 1 },
    { q: "虻【】取らず", options: ["蜘蛛", "蟻", "蜂", "蝉"], answer: 2 },
    { q: "【】で鯛を釣る", options: ["烏賊", "蛸", "海老", "鰯"], answer: 2 },
    { q: "【】子に教えられる", options: ["優秀な", "不出来な", "妻", "負うた"], answer: 3 },
    { q: "可愛い子には【】をさせよ", options: ["戦争", "冒険", "旅", "家事"], answer: 2 },
    { q: "聞いて【】見て地獄", options: ["天国", "極楽", "桃源郷", "冥界"], answer: 2 },
    { q: "朱に交われば【】くなる", options: ["赤", "赫", "紫", "橙"], answer: 0 },
    { q: "【】百まで踊り忘れず", options: ["踊り子", "雀", "天女", "巫女"], answer: 1 },
    { q: "塵も積もれば【】となる", options: ["山", "屑", "福", "峠"], answer: 0 },
    { q: "出る【】は打たれる", options: ["頭", "顎", "瘤", "杭"], answer: 3 },

    { q: "ない【】は振れぬ", options: ["物", "賽", "袖", "金"], answer: 2 },
    { q: "【】は人の為ならず", options: ["情け", "人情", "嘘", "不正"], answer: 0 },
    { q: "喉元過ぎれば【】を忘れる", options: ["感謝", "熱さ", "夢", "不安"], answer: 1 },
    { q: "早起きは【】の徳", options: ["三文", "千両", "人生", "健康"], answer: 0 },
    { q: "下手な【】も数撃ちゃ当たる", options: ["水鉄砲", "鉄砲", "弓矢", "豆鉄砲"], answer: 1 },
    { q: "待てば【】路の日和あり", options: ["海", "道", "回", "進"], answer: 0 },
    { q: "柳の下の【】", options: ["金魚", "泥鰌", "鰻", "メダカ"], answer: 1 },
    { q: "禍を転じて【】と為す", options: ["賽", "徳", "金", "福"], answer: 3 },
    { q: "一年の計は【】にあり", options: ["年末", "元旦", "誕生日", "早朝"], answer: 1 },
    { q: "なくて【】癖", options: ["七", "性", "口", "手"], answer: 0 },
    
    { q: "怒【】天を衝く", options: ["拳", "髪", "髭", "心"], answer: 1 },
    { q: "思案投げ【】", options: ["顔", "首", "目", "脳"], answer: 1 },
    { q: "【】に腹は代えられぬ", options: ["背", "頭", "心", "手"], answer: 0 },
    { q: "【】に一物", options: ["腹", "口", "背", "腕"], answer: 0 },
    { q: "七重の【】を八重に折る", options: ["膝", "腕", "骨", "指"], answer: 0 },
    { q: "悪貨は良貨を【】する", options: ["駆逐", "破壊", "生成", "超過"], answer: 0 },
    { q: "金に【】を付けぬ", options: ["出し惜しみ", "欲", "糸目", "手"], answer: 2 },
    { q: "金【】の交わり", options: ["銀", "石", "塊", "友"], answer: 1 },
    { q: "爪で拾って【】でこぼす", options: ["簑", "掌", "バケツ", "口"], answer: 0 },
    { q: "【】勘定", options: ["百舌", "烏", "燕", "雀"], answer: 0 },

    { q: "衣食足りて【】を知る", options: ["住", "金", "人", "礼節"], answer: 3 },
    { q: "棚から【】", options: ["牡丹餅", "茸", "洋服", "金"], answer: 0 },
    { q: "鴨が【】を背負って来る", options: ["剣", "葱", "鷲", "鰐"], answer: 1 },
    { q: "【】頭を懸けて狗肉を売る", options: ["牛", "羊", "豚", "鶏"], answer: 1 },
    { q: "痛む上に【】を塗る", options: ["砂糖", "塩", "醤油", "味噌"], answer: 1 },
    { q: "【】撫で声", options: ["猫", "兎", "犬", "鳥"], answer: 0 },
    { q: "【】の這い出る隙もない", options: ["蟻", "蜘蛛", "蛇", "鼠"], answer: 0 },
    { q: "【】に油揚げを攫われる", options: ["烏", "鷲", "狐", "鷹"], answer: 1 },
    { q: "鳥なき里の【】", options: ["蝙蝠", "虫", "猫", "魚"], answer: 0 },
    { q: "【】もおだてりゃ木に登る", options: ["猫", "パンダ", "豚", "熊"], answer: 2 },

    { q: "朝に紅顔有りて夕べには【】となる", options: ["白骨", "青顔", "白顔", "屍"], answer: 0 },
    { q: "江戸っ子は五月の【】の吹流し", options: ["鯉", "嘘", "布", "真理"], answer: 0 },
    { q: "狡兎死して【】烹らる", options: ["走狗", "野猪", "亥の子", "ウリ坊"], answer: 0 },
    { q: "人生【】古来稀なり", options: ["七十", "六十", "八十", "九十"], answer: 0 },
    { q: "前【】の轍を踏む", options: ["車", "馬", "後", "脚"], answer: 0 },
    { q: "創業は易く【】は難し", options: ["継続", "守成", "営業", "倒産"], answer: 1 },
    { q: "問うに落ちず【】に落ちる", options: ["語る", "会話", "奈落", "穴"], answer: 0 },
    { q: "十で神童十五で才子【】過ぎれば只の人", options: ["三十", "二十", "四十", "五十"], answer: 1 },
    { q: "恥と【】はかき次第", options: ["絵", "記憶", "嘘", "夢"], answer: 0 },
    { q: "【】急を告げる", options: ["風雲", "雷雲", "雨雲", "星雲"], answer: 0 },

    { q: "つらくても辛抱して続ければ、いつかは成し遂げられるということ。", options: ["石の上にも三年", "石の上にも五年", "石の上にも八年", "石の上にも十年"], answer: 0 },
    { q: "用心の上にさらに用心を重ねて物事を行うこと。", options: ["石橋を叩いて渡る", "人を叩いて渡る", "道路を叩いて渡る", "吊り橋を叩いて渡る"], answer: 0 },
    { q: "どんなんにその道の達人や名人であっても、奢りや油断により失敗してしまうこともあるということのたとえ。", options: ["河童の川流れ", "猿の川流れ", "師匠の川流れ", "桃の川流れ"], answer: 0 },
    { q: "人の目に付かない所で、誰かのために苦労をしたり努力をしたりする事や、そのような人。", options: ["縁の下の力持ち", "緑の下の力持ち", "録の下の力持ち", "禄の下の力持ち"], answer: 0 },
    { q: "自分の知らないことはそのままにせず、積極的に聞いたほうが良いという意味。", options: ["聞くは一時の恥聞かぬは一生の恥", "聞くは一時の恥聞かぬは人生の恥", "聞くは数秒の恥聞かぬは一生の恥", "聞くは一時の恥聞かぬは一時の恥"], answer: 0 },
    { q: "すでにしてしまったことを、後から悔やんでもどうにもならないということ。", options: ["後悔先に立たず", "苦労先に立たず", "心配先に立たず", "不幸先に立たず"], answer: 0 },
    { q: "相手への心づかいを忘れてしまうと、不和のもとになるというたとえ。", options: ["親しき仲にも礼儀あり", "親しき中にも礼儀あり", "親しき仲にも礼節あり", "親しき仲にも感謝あり"], answer: 0 },
    { q: "よいことをするのにためらうなの意。", options: ["善は急げ", "急いては急げ", "とにかく急げ", "行動は急げ"], answer: 0 },
    { q: "いま一息で手に入れかけて失った物が一段と惜しく思われることのたとえ。", options: ["釣り落とした魚は大きい", "釣り落とした鯛は大きい", "釣り落とした鮪は大きい", "釣り落とした鯨は大きい"], answer: 0 },
    { q: "二つのものの間に非常に差のあることのたとえ。", options: ["月とすっぽん", "鷹と雀", "犬と猫", "バカと天才"], answer: 0 },

    { q: "時間は貴重で有効なものだから、むだに費やしてはならない。", options: ["時は金なり", "時は銀なり", "時は神なり", "時は友なり"], answer: 0 },
    { q: "どれもこれも似たり寄ったりで、殆ど変わらず、抜きん出た者がいない事。", options: ["どんぐりの背比べ", "鼠の背比べ", "筍の背比べ", "妖精の背比べ"], answer: 0 },
    { q: "何の手応えも、効き目もないことのたとえ。", options: ["塩に釘", "糖に釘", "水に釘", "木に釘"], answer: 1 },
    { q: "苦労せずに、簡単に大きな利益を手にすること。", options: ["濡れ手で米", "濡れ手で粟", "濡れ手で栗", "濡れ手で悪手"], answer: 1 },
    { q: "あれこれと何度も人から聞くよりも、実際に自分の目で確かめるほうが確実だというたとえ。", options: ["百聞は一見に如かず", "百聞は一瞬に如かず", "百見は一聞に如かず", "百聞は二見に如かず"], answer: 0 },
    { q: "自分でした言動が原因で、自ら受ける苦しみや災禍（さいか）のこと。", options: ["身から出た埃", "身から出た塵", "身から出た穢れ", "身から出た錆"], answer: 3 },
    { q: "不運の上に不運が重なること。", options: ["弱り目に祟り目", "弱り目に呪い目", "弱り目に負い目", "弱り目に白い目"], answer: 0 },
    { q: "具体的な事実にものをいわせるのは、説得への第一歩であるということ。", options: ["論より行動", "論より証明", "論より証拠", "論より経験"], answer: 2 },
    { q: "この季節の日暮れはとても早いというたとえ", options: ["秋の日は釣瓶落とし", "夏の日は釣瓶落とし", "春の日は釣瓶落とし", "冬の日は釣瓶落とし"], answer: 0 },
    { q: "間違えたり、何気なくしたと思っていたことが、偶然良い結果をもたらすというたとえ。", options: ["不幸の功名", "怪我の功名", "失敗の功名", "火傷の功名"], answer: 1 },

    { q: "相手を喜ばせるようなことを言う。", options: ["耳をくすぐる", "脇をくすぐる", "腹をくすぐる", "足をくすぐる"], answer: 0 },
    { q: "過度に倹約する。", options: ["爪に火をともす", "髪に火をともす", "尾に火をともす", "蠟燭に火をともす"], answer: 0 },
    { q: "ばかげていることに対して、おかしくてたまらないと思う様子。", options: ["腹で茶を沸かす", "臍で茶を沸かす", "額で茶を沸かす", "手で茶を沸かす"], answer: 1 },
    { q: "得意になっている者を出し抜いて、恥をかかせる。", options: ["鼻を明かす", "目を明かす", "手の内を明かす", "顔を明かす"], answer: 0 },
    { q: "何回も同じことを繰り返し言う。", options: ["頭を酸っぱくする", "顔を酸っぱくする", "口を酸っぱくする", "耳を酸っぱくする"], answer: 2 },
    { q: "不正に手に入れたお金は、無駄に使ってしまい残らないというたとえ。", options: ["悪銭身に付かず", "悪銭死に金", "悪銭無駄使い", "悪銭残らず"], answer: 0 },
    { q: "金があるときには慕ってきた者も、金がなくなると見向きもしなくなるので注意が必要だという事。", options: ["金の切れ目が縁の切れ目", "金の切れ目が人生の切れ目", "金の切れ目が命の切れ目", "金の切れ目が緑の切れ目"], answer: 0 },
    { q: "金持ちは喧嘩をすれば損をすることを知っていて他人と争わない。", options: ["金持ち喧嘩せず", "金持ち戦争せず", "金持ち無駄使いせず", "金持ち驕らず"], answer: 0 },
    { q: "世の中は都合よく出来ているわけではないという戒め。", options: ["只より高い物はない", "命より高い物はない", "友より高い物はない", "時間より高い物はない"], answer: 0 },
    { q: "無計画に金を使って動きがとれなくなるたとえ。", options: ["行き大名の帰り乞食", "行き王族の帰り乞食", "行き神の帰り奴隷", "行き金持ちの帰り無一文"], answer: 0 },

    { q: "冷たい扱いを受けること。", options: ["冷や飯を食う", "冷食を食う", "冷や汁を食う", "冷や麦を食う"], answer: 0 },
    { q: "何事もよい結果が出るまでには、それなりの時間がかかるというたとえ。", options: ["桃栗三年柿八年", "桃栗四年柿八年", "桃栗三年柿九年", "桃栗五年柿十年"], answer: 0 },
    { q: "自分が間違っていることが、はっきりとわかっていても、間違っていないと言い張って譲らないことのたとえ。", options: ["這っても黒豆", "這っても枝豆", "這ってもそら豆", "這っても納豆"], answer: 0 },
    { q: "むだ話をして、仕事を怠ける。", options: ["油を売る", "米を売る", "油を買う", "米を買う"], answer: 0 },
    { q: "苦手なものの前で萎縮するたとえ。", options: ["蛞蝓に砂糖", "蛞蝓に塩", "蛞蝓に醤油", "蛞蝓に味噌"], answer: 1 },
    { q: "大勢の人がいっせいに騒ぎ出して手がつけられない状態のたとえ。", options: ["蟻の巣をつついたよう", "蜘蛛の巣をつついたよう", "蜂の巣をつついたよう", "鳥の巣をつついたよう"], answer: 0 },
    { q: "大勢の人があっという間に散って逃げる様子。", options: ["蜘蛛の子を散らす", "鳥の子を散らす", "蛇の子を散らす", "龍の子を散らす"], answer: 0 },
    { q: "秋は空が澄みわたって高く晴れ、馬は肥えてたくましくなるという意で、秋の好時節をいう。", options: ["天高く馬肥ゆる秋", "天高く牛肥ゆる秋", "天高く馬肥ゆる春", "天高く牛肥ゆる春"], answer: 0 },
    { q: "とても忙しいので、誰でも良いから手伝って欲しいという意味。", options: ["猫の手も借りたい", "猿の手も借りたい", "犬の手も借りたい", "鳥の手も借りたい"], answer: 0 },
    { q: "愚かな者には、いくら立派な話をしても何の役にも立たない事。", options: ["羊に対して琴を禅ず", "豚に対して琴を禅ず", "馬に対して琴を禅ず", "牛に対して琴を禅ず"], answer: 3 },

    { q: "善良な人と交われば、その感化を受けて善人になる。", options: ["麻の中の蓬", "麻の中の蓮", "麻の中のミント", "麻の中の葉薊"], answer: 0 },
    { q: "平凡な親からは非凡な子供は生まれない。", options: ["瓜の蔓に西瓜はならぬ", "瓜の蔓に茄子はならぬ", "瓜の蔓に栗はならぬ", "瓜の蔓にトマトはならぬ"], answer: 1 },
    { q: "必要もないのに先回りしすぎる無駄な行為のたとえ。", options: ["暮れぬ先の蠟燭", "暮れぬ先の灯火", "暮れぬ先の提灯", "暮れぬ先の街灯"], answer: 2 },
    { q: "期日が当てにならないこと。", options: ["紺屋の明後日", "紺屋の明日", "紺屋の明々後日", "紺屋の昨日"], answer: 0 },
    { q: "道理も明らかになり自分の生き方に迷いがなくなったということ。", options: ["二十にして惑わず", "三十にして惑わず", "四十にして惑わず", "五十にして惑わず"], answer: 2 },
    { q: "世の中の移り変わりの激しいたとえ。", options: ["滄海変じて桑田となる", "滄田変じて桑田となる", "滄山変じて桑田となる", "滄丘変じて桑田となる"], answer: 0 },
    { q: "好事には、とかく障害の多いことのたとえ。", options: ["月に叢雲花に雨", "月に叢雲花に星", "月に叢雲花に風", "月に叢雲花に水"], answer: 2 },
    { q: "自分の年齢も考えずに無茶をすることは健康に良くないという事。", options: ["年寄りの冷や水", "年寄りの長歩き", "年寄りの強がり", "年寄りのおせっかい"], answer: 0 },
    { q: "過ちを一度犯すと、何度繰り返しても平気になる、またはもっとひどいことを平気でするようになるというたとえ。", options: ["濡れぬ先こそ露をも厭え", "濡れぬ先こそ霜をも厭え", "濡れぬ先こそ雪をも厭え", "濡れぬ先こそ霧をも厭え"], answer: 0 },
    { q: "失敗した者は沈黙すべきだというたとえ。", options: ["敗軍の将は兵を語らず", "敗軍の将は戦略を語らず", "敗軍の将は多くを語らず", "敗軍の将は命を語らず"], answer: 0 },
]


// ---- クイズデータ ----
const QUIZ_DATA = {
  アニメ: animeQuestions,
  漢字: KanjiQuestions,
  ことわざ: proverbQuestions,
  //化学: chemistryQuestions,
  //数学: mathQuestions,
  //IT: ITQuestions
};

// ---- 初期化 ----
let playerName = localStorage.getItem("quiz_current_name") || "";
let selectedGenre = "アニメ";
let quizQuestions = [];
let answers = [];
let score = 0;
let profiles = JSON.parse(localStorage.getItem("quiz_profiles")||"{}");

const nameSection = document.getElementById("nameSection");
const welcomeSection = document.getElementById("welcome");
const playerNameDisplay = document.getElementById("playerNameDisplay");
const adminPanel = document.getElementById("adminPanel");
const adminPassInput = document.getElementById("adminPass");
const adminLoginBtn = document.getElementById("adminLoginBtn");

function setPlayerName(name){
  playerName = name;
  localStorage.setItem("quiz_current_name", name);
  if(!profiles[name]) profiles[name]={scores:{}};
  localStorage.setItem("quiz_profiles", JSON.stringify(profiles));
  nameSection.classList.add("hidden");
  welcomeSection.classList.remove("hidden");
  playerNameDisplay.textContent=name;
}
if(playerName) setPlayerName(playerName);

document.getElementById("saveNameBtn").onclick=()=>{
  const input=document.getElementById("playerNameInput").value.trim();
  if(!input){ alert("名前を入力してください"); return; }
  if(profiles[input]){ alert("既に存在します"); return; }
  setPlayerName(input);
};

// ジャンルボタン
const genreButtonsDiv = document.getElementById("genreButtons");
Object.keys(QUIZ_DATA).forEach(g=>{
  const btn = document.createElement("button");
  btn.textContent=g;
  btn.className="genreBtn";
  btn.onclick=()=>startQuiz(g);
  genreButtonsDiv.appendChild(btn);
});

// クイズ開始
function startQuiz(genre){
  adminPanel.classList.add("hidden");
  document.getElementById("ranking").classList.add("hidden");
  selectedGenre = genre;
  quizQuestions = [...QUIZ_DATA[genre]].sort(()=>Math.random()-0.5).slice(0, QUESTIONS_PER_GENRE);
  answers = Array(QUESTIONS_PER_GENRE).fill(null);
  score = 0;
  document.getElementById("home").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  renderQuiz(0);
}

function renderQuiz(idx){
  const qDiv = document.getElementById("quiz");
  qDiv.innerHTML="";
  const q = quizQuestions[idx];
  const p = document.createElement("p"); p.textContent=`${idx+1}. ${q.q}`; qDiv.appendChild(p);
  q.options.forEach((opt,oi)=>{
    const btn = document.createElement("button");
    btn.textContent=opt;
    btn.onclick=()=>{
      answers[idx]=oi;
      const bonus = idx>0 && answers[idx-1]===quizQuestions[idx-1].answer ? STREAK_BONUS_STEP : 0;
      score += (oi===q.answer ? BASE_POINTS+bonus : 0);
      if(idx===QUESTIONS_PER_GENRE-1){ saveScore(); showResult(); }
      else renderQuiz(idx+1);
    };
    qDiv.appendChild(btn);
  });
}

// 結果
function saveScore(){
  if(!profiles[playerName].scores[selectedGenre]) profiles[playerName].scores[selectedGenre]=[];
  profiles[playerName].scores[selectedGenre].push(score);
  localStorage.setItem("quiz_profiles", JSON.stringify(profiles));
}

function showResult(){
  document.getElementById("quiz").classList.add("hidden");
  const rDiv = document.getElementById("result"); 
  rDiv.classList.remove("hidden");
  let html = `<h2>結果: ${score}点</h2>`;
  html += "<h3>各問題の結果</h3><ul>";
  quizQuestions.forEach((q,i)=>{
    const isCorrect = answers[i]===q.answer;
    html += `<li>問題${i+1} ${isCorrect?'<span style="color:green">〇</span>':'<span style="color:red">×</span>'}</li>`;
  });
  html += "</ul>";
  html += `<button onclick="showRanking()">ランキング</button>`;
  html += `<button onclick="location.reload()">ホーム</button>`;
  rDiv.innerHTML = html;
}

// ランキング
document.querySelectorAll("#rankingTabs .tab").forEach(t=>{
  t.onclick = ()=>switchRankingTab(t.dataset.tab);
});
document.getElementById("showRankingBtn").onclick=showRanking;

function switchRankingTab(tabName){
  document.querySelectorAll("#rankingTabs .tab").forEach(t=>{
    t.classList.toggle("active-tab", t.dataset.tab===tabName);
  });
  renderRanking(tabName);
}

function showRanking(){
  document.getElementById("result").classList.add("hidden");
  document.getElementById("ranking").classList.remove("hidden");
  switchRankingTab("ジャンル");
}

function renderRanking(tab){
  const content = document.getElementById("rankingContent");
  content.innerHTML="";
  if(tab==="ジャンル"){
    for(const g of Object.keys(QUIZ_DATA)){
      const h3 = document.createElement("h3"); h3.textContent=g; content.appendChild(h3);
      const list = Object.entries(profiles)
        .map(([name,d])=>({name,score:d.scores[g]?Math.max(...d.scores[g]):0}))
        .sort((a,b)=>b.score-a.score);
      list.forEach((u,i)=>{
        const p = document.createElement("p");
        p.textContent=`${i+1}. ${u.name} ${u.score}`;
        content.appendChild(p);
      });
    }
  } else if(tab==="合計"){
    const totalList = Object.entries(profiles)
      .map(([name,d])=>({
        name,
        score: Object.keys(QUIZ_DATA).reduce((sum,g)=>{ 
          const maxScore=d.scores[g]?Math.max(...d.scores[g]):0;
          return sum+maxScore;
        },0)
      }))
      .sort((a,b)=>b.score-a.score);

    const h3 = document.createElement("h3"); h3.textContent="全ジャンル合計"; content.appendChild(h3);
    totalList.forEach((u,i)=>{
      const p = document.createElement("p");
      p.textContent=`${i+1}. ${u.name} ${u.score}`;
      content.appendChild(p);
    });
  }
}

// ---- 管理者パネル ----
function renderAdminUserList(){
  const listDiv = document.getElementById("adminUserList");
  listDiv.innerHTML="";
  Object.keys(profiles).forEach(name=>{
    const div=document.createElement("div");
    div.style.marginBottom="6px";
    div.style.display="flex";
    div.style.alignItems="center";
    div.style.gap="6px";

    const span=document.createElement("span"); span.textContent=name;

    const btnData=document.createElement("button");
    btnData.textContent="[ユーザーデータ削除]";
    btnData.onclick=()=>{ 
      if(confirm(`${name} のスコアデータを削除しますか？`)){
        profiles[name].scores={};
        localStorage.setItem("quiz_profiles",JSON.stringify(profiles));
        renderAdminUserList();
      }
    };

    const btnAll=document.createElement("button");
    btnAll.textContent="[ユーザー削除]";
    btnAll.onclick=()=>{ 
      if(confirm(`${name} を完全に削除しますか？`)){
        delete profiles[name];
        localStorage.setItem("quiz_profiles",JSON.stringify(profiles));
        if(playerName===name){
          localStorage.removeItem("quiz_current_name"); 
          playerName=""; 
          nameSection.classList.remove("hidden"); 
          welcomeSection.classList.add("hidden"); 
        }
        renderAdminUserList();
      }
    };

    div.appendChild(span);
    div.appendChild(btnData);
    div.appendChild(btnAll);
    listDiv.appendChild(div);
  });
}

// ログアウトボタン
document.getElementById("logoutAdminBtn").onclick=()=>{
  adminPanel.classList.add("hidden");
};

// Ctrl+Alt+Hで管理者パネル表示（ログイン済みのみ）
document.addEventListener("keydown",(e)=>{
  if(e.ctrlKey && e.altKey && e.key.toLowerCase()==="h"){
    if(!playerName) return;
    adminPanel.classList.remove("hidden");
    adminPassInput.style.display="inline-block";
    adminLoginBtn.style.display="inline-block";
    adminPassInput.focus();
    document.querySelectorAll("#adminPanel button").forEach(btn=>{
      if(!["adminLoginBtn","logoutAdminBtn"].includes(btn.id)) btn.disabled=true;
    });
  }
});

// パスキー認証
adminLoginBtn.onclick = ()=>{
  if(adminPassInput.value === ADMIN_PASSKEY){
    document.querySelectorAll("#adminPanel button").forEach(btn=>btn.disabled=false);
    renderAdminUserList();
    adminPassInput.value=""; // 入力欄クリア
    alert("管理者認証成功！");
  } else {
    alert("パスキー違います");
  }
};
</script>
</body>
</html>
